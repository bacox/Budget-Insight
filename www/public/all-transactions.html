<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All transactions</title>
    <style>
        body {
            /*text-align: center;*/
            font: 1em roboto, sans-serif;
        }

        body { font: 12px Arial;}

        path {
            stroke: steelblue;
            stroke-width: 2;
            fill: none;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: grey;
            stroke-width: 1;
            shape-rendering: crispEdges;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.min.js" integrity="sha256-+9Mf3cAVmxxudDsr1XwXUeRZFtvdWVYdq5/vcgiYyNU=" crossorigin="anonymous"></script>-->
    <script src="https://d3js.org/d3.v4.js"></script>
<!--    <script src="https://d3js.org/d3.v3.min.js"></script>-->

</head>
<body>
<!-- Titla of the page -->
<div>Home</div>

<!-- Menu -->
<div>
    <div>Menu</div>
    <div><a href="index.html">Home</a></div>
    <div><a href="all-transactions.html">All transactions</a></div>
    <div><a href="by-id.html">Get transaction by id</a></div>
</div>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>


<script>
    $(function() {
        console.log( "ready!" );

        $.ajax("api-v2/getAll", {
            success: function(data) {
                // $('#main').html($(data).find('#main *'));
                console.log('Got a positive response');
                console.log(data.data);
                console.log(data.data[0].id);
                console.log(_.map(data.data, 'balanceBefore'))
                let idx = 0;
                let transactions = _.map(data.data, item => {
                    item.seq = idx++;
                    return item
                })

                let graphData = _.map(transactions, item => {
                    return {time: item.seq, value: item.balanceBefore}
                })
                lineChart(graphData);



            },
            error: function(err) {
                console.log('An error occurred');
                console.log(err.statusCode());
            }
        });
    });


    // // Set the dimensions of the canvas / graph
    // var margin = {top: 30, right: 20, bottom: 30, left: 50},
    //     width = 600 - margin.left - margin.right,
    //     height = 270 - margin.top - margin.bottom;
    //
    // // Parse the date / time
    // var parseDate = d3.time.format("%d-%m-%Y").parse;
    //
    // // Set the ranges
    // var x = d3.time.scale().range([0, width]);
    // var y = d3.scale.linear().range([height, 0]);
    //
    // // Define the axes
    // var xAxis = d3.svg.axis().scale(x)
    //     .orient("bottom").ticks(5);
    //
    // var yAxis = d3.svg.axis().scale(y)
    //     .orient("left").ticks(5);
    //
    // // Define the line
    // var valueline = d3.svg.line()
    //     .x(function(d) { return x(d.date); })
    //     .y(function(d) { return y(d.close); });
    //
    // // Adds the svg canvas
    // var svg = d3.select("body")
    //     .append("svg")
    //     .attr("width", width + margin.left + margin.right)
    //     .attr("height", height + margin.top + margin.bottom)
    //     .append("g")
    //     .attr("transform",
    //         "translate(" + margin.left + "," + margin.top + ")");

    var data = [
        {time: "01-01-2000", value:23.2},
        {time: "02-01-2000", value:22.2},
        {time: "03-01-2000", value:21.5},
        {time: "04-01-2000", value:21.2},
        {time: "05-01-2000", value:20.8},
        {time: "06-01-2000", value:21.6},
        {time: "01-02-2000", value:21.6},
        {time: "01-03-2000", value:22.0},
        {time: "01-04-2000", value:22.4},
        {time: "01-05-2000", value:23.3},
    ];


    // // Get the data
    // //d3.csv("data.csv", function(error, data) {
    // data.forEach(function(d) {
    //     d.date = parseDate(d.time);
    //     d.close = +d.value;
    // });
    //
    // // Scale the range of the data
    // x.domain(d3.extent(data, function(d) { return d.date; }));
    // y.domain([0, d3.max(data, function(d) { return d.value; })]);
    //
    // // Add the valueline path.
    // svg.append("path")
    //     .attr("class", "line")
    //     .attr("d", valueline(data));
    //
    // // Add the X Axis
    // svg.append("g")
    //     .attr("class", "x axis")
    //     .attr("transform", "translate(0," + height + ")")
    //     .call(xAxis);
    //
    // // Add the Y Axis
    // svg.append("g")
    //     .attr("class", "y axis")
    //     .call(yAxis);

    //});


function lineChart(data) {
    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 20, bottom: 30, left: 50},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    // parse the date / time
    var parseTime = d3.timeParse("%d-%m-%Y");

    // set the ranges
    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    // define the line
    var valueline = d3.line()
        .x(function(d) { return x(d.time); })
        .y(function(d) { return y(d.value); });

    // append the svg obgect to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    // Get the data
    // d3.csv("data.csv", function(error, data) {
    //     if (error) throw error;
    console.log('Data');
    console.log(data);
    // format the data
    data.forEach(function(d) {
        // d.time = parseTime(d.time);
        d.time = d.time;
        d.value = +d.value;
    });

    // Scale the range of the data
    x.domain(d3.extent(data, function(d) { return d.time; }));
    y.domain([0, d3.max(data, function(d) { return d.value; })]);

    // Add the valueline path.
    svg.append("path")
        .data([data])
        .attr("class", "line")
        .attr("d", valueline);

    // Add the X Axis
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

    // Add the Y Axis
    svg.append("g")
        .call(d3.axisLeft(y));
}


    // });
</script>
</body>
</html>